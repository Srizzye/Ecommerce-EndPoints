openapi: 3.0.0
info:
  title: E-Commerce API
  description: API documentation for the E-Commerce backend application.
  version: 1.0.0
servers:
- url: http://localhost:3000
  description: Local Development Server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    UserRegister:
      type: object
      required:
      - name
      - email
      - password
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        password:
          type: string

    UserLogin:
      type: object
      required:
      - email
      - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    Product:
      type: object
      properties:
        brand:
          type: string
        price:
          type: number
        subcategory:
          type: string
        description:
          type: string
        ratings:
          type: number
        release:
          type: string
          format: date

    # Added this back because it is required by /user/showCart
    ProductItem:
      type: object
      properties:
        _id:
          type: string
          example: "60d0fe4f5311236168a109ca"
        name:
          type: string
          example: "Wireless Headphones"
        price:
          type: number
          example: 99.99
        category:
          type: string
          example: "Electronics"
        description:
          type: string
        ratings:
          type: number

    CommentRequest:
      type: object
      properties:
        message:
          type: string
        ratings:
          type: number
          default: 0

    ReviewRequest:
      type: object
      required:
      - rating
      properties:
        rating:
          type: number

tags:
- name: Auth
  description: User authentication and registration
- name: Home & Admin
  description: Homepage data and Admin product management
- name: Products
  description: Product retrieval, filtering, and interactions
- name: User Cart
  description: Cart management and ordering endpoints

paths:
  # -------------------------
  # AUTH ROUTES
  # -------------------------
  /auth/register:
    post:
      summary: Register a new user
      tags: [ Auth ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegister'
      responses:
        200:
          description: Registered Successfully
        400:
          description: User Email Already Exists
        500:
          description: Server Error

  /auth/login:
    post:
      summary: Login user
      tags: [ Auth ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
      responses:
        200:
          description: Logged In Successfully (Returns Access Token)
          headers:
            Set-Cookie:
              schema:
                type: string
                description: access_token cookie
        404:
          description: User Not Found

  # -------------------------
  # HOME & ADMIN ROUTES
  # -------------------------
  /:
    get:
      summary: Get Home Page Products
      description: Returns top ranked products grouped by subcategory
      tags: [ Home & Admin ]
      responses:
        200:
          description: List of products
        500:
          description: Server Error

  /add:
    post:
      summary: Add a new product (Admin Only)
      tags: [ Home & Admin ]
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'
      responses:
        200:
          description: Product Added
        403:
          description: No Access
        500:
          description: Server Error

  /update:
    post:
      summary: Update a product (Admin Only)
      tags: [ Home & Admin ]
      security:
      - bearerAuth: []
      parameters:
      - in: query
        name: id
        schema:
          type: string
        required: false
      responses:
        200:
          description: Product Updated
        403:
          description: No Access

  /delete:
    delete:
      summary: Delete a product (Admin Only)
      tags: [ Home & Admin ]
      security:
      - bearerAuth: []
      parameters:
      - in: query
        name: id
        schema:
          type: string
      responses:
        200:
          description: Product Deleted
        403:
          description: No Access

  # -------------------------
  # PRODUCT ROUTES
  # -------------------------
  /product/all:
    get:
      summary: Get all products
      tags: [ Products ]
      responses:
        200:
          description: List of all products
        500:
          description: Server Error

  /product/sub/{sub_id}:
    get:
      summary: Get products by Subcategory ID
      tags: [ Products ]
      parameters:
      - in: path
        name: sub_id
        schema:
          type: string
        required: true
      responses:
        200:
          description: List of products in subcategory

  /product/cat/{cat_id}:
    get:
      summary: Get subcategories by Category ID
      tags: [ Products ]
      parameters:
      - in: path
        name: cat_id
        schema:
          type: string
        required: true
      responses:
        200:
          description: List of subcategories

  /product/filter/{sub_id}/{brand}/{ltprice}/{gtprice}:
    get:
      summary: Filter products
      tags: [ Products ]
      parameters:
      - in: path
        name: sub_id
        required: true
        schema:
          type: string
      - in: path
        name: brand
        required: true
        schema:
          type: string
      - in: path
        name: ltprice
        required: true
        description: Less than price (Max Price)
        schema:
          type: number
      - in: path
        name: gtprice
        required: true
        description: Greater than price (Min Price)
        schema:
          type: number
      responses:
        200:
          description: Filtered list of products

  /product/addcomment/{parent_id}:
    post:
      summary: Add a comment to a product
      tags: [ Products ]
      security:
      - bearerAuth: []
      parameters:
      - in: path
        name: parent_id
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentRequest'
      responses:
        200:
          description: Commented

  /product/showcomment/{parent_id}:
    get:
      summary: Show direct comments for an ID
      tags: [ Products ]
      parameters:
      - in: path
        name: parent_id
        required: true
        schema:
          type: string
      responses:
        200:
          description: List of comments

  /product/showallcomments/{parent_id}:
    get:
      summary: Show comments with nested child comments
      tags: [ Products ]
      parameters:
      - in: path
        name: parent_id
        required: true
        schema:
          type: string
      responses:
        200:
          description: Nested comments

  /product/addreviews/{parent_id}:
    post:
      summary: Add a rating/review to a product
      tags: [ Products ]
      parameters:
      - in: path
        name: parent_id
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReviewRequest'
      responses:
        200:
          description: Review Added (Triggers addcomment internally)

  /product/addlikes/{parent_id}:
    post:
      summary: Like a comment
      tags: [ Products ]
      parameters:
      - in: path
        name: parent_id
        required: true
        schema:
          type: string
      responses:
        200:
          description: Liked The Comment

  /product/adddislikes/{parent_id}:
    post:
      summary: Dislike a comment
      tags: [ Products ]
      parameters:
      - in: path
        name: parent_id
        required: true
        schema:
          type: string
      responses:
        200:
          description: Comment Disliked

  # -------------------------
  # USER CART ROUTES
  # -------------------------
  /user/addCart/{product_id}:
    post:
      summary: Add a product to the cart
      description: Adds a specific product ID to the user's cart. Creates a cart if one doesn't exist.
      tags: [ User Cart ]
      security:
      - bearerAuth: []
      parameters:
      - in: path
        name: product_id
        schema:
          type: string
        required: true
        description: The MongoDB ObjectId of the product to add
      responses:
        200:
          description: Success message
          content:
            text/plain:
              schema:
                type: string
                example: "Items Added To Cart"
        500:
          description: Server Error

          /user/removeCart/{product_id}:
    delete:
      summary: Remove a product from the cart
      description: Removes a specific product ID from the user's shopping cart.
      tags: [ User Cart ]
      security:
      - bearerAuth: []
      parameters:
      - in: path
        name: product_id
        schema:
          type: string
        required: true
        description: The MongoDB ObjectId of the product to remove
      responses:
        200:
          description: Success message
          content:
            text/plain:
              schema:
                type: string
                example: "Item Removed"
        500:
          description: Server Error

  /user/showCart:
    get:
      summary: Retrieve cart items
      description: Fetches all products currently in the logged-in user's cart.
      tags: [ User Cart ]
      security:
      - bearerAuth: []
      responses:
        200:
          description: List of products in the cart
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductItem'
        500:
          description: Server Error

  /user/placeOrder:
    get:
      summary: Place an order
      description: Generates a text summary of all items in the cart and the total price.
      tags: [ User Cart ]
      security:
      - bearerAuth: []
      responses:
        200:
          description: Order summary and total cost
          content:
            text/plain:
              schema:
                type: string
                example: |
                  name: Wireless Headphones,
                  category: Electronics,
                  price: 99.99

                  TOTAL : 99.99
        500:
          description: Server Error
